import{n,_ as o}from"./index.7707aae4.js";const d=""+new URL("empty.68206c04.png",import.meta.url).href;var p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wrapper",attrs:{id:"\u{1F6D2}"}},[s("sm-box",{attrs:{title:"\u8D2D\u7269\u8F66"}},[t.products.length?s("div",[s("div",{staticClass:"header"},[s("div",{staticClass:"left"},[s("span",{staticClass:"title"},[t._v("\u5546\u54C1\u4FE1\u606F")])]),s("div",{staticClass:"right"},[s("span",{staticClass:"price"},[t._v("\u5355\u4EF7")]),s("span",{staticClass:"quantity"},[t._v("\u6570\u91CF")]),s("span",{staticClass:"subtotal"},[t._v("\u5C0F\u8BA1")]),s("span",{staticClass:"operation"},[t._v("\u64CD\u4F5C")])])]),s("div",{staticClass:"body"},[s("sm-checkbox-group",{model:{value:t.selSkus,callback:function(i){t.selSkus=i},expression:"selSkus"}},[s("transition-group",{attrs:{tag:"ul",name:"group",appear:""}},t._l(t.products,function(i){var l,u;return s("li",{key:i.sku.id,staticClass:"item"},[s("div",{staticClass:"left"},[s("sm-checkbox",{attrs:{title:i.sku.id,"hide-title":""}}),s("img",{attrs:{src:i.sku.image}}),s("div",{staticClass:"info"},[s("router-link",{staticClass:"title",attrs:{to:`/mall/item/${i.sku.id}`}},[t._v(t._s(i.sku.title))]),s("ul",{staticClass:"specs"},t._l(i.sku.specs,function(a,r){return s("li",{key:r,staticClass:"spec"},[t._v(" "+t._s(a.value)+" ")])}),0)],1)],1),s("div",{staticClass:"right"},[s("div",{staticClass:"price"},[t._v("\xA5 "+t._s(i.sku.price.toFixed(2)))]),s("div",{staticClass:"quantity"},[s("sm-input-number",{on:{minus:function(a){return t.handleMinus(i)},plus:function(a){return t.handlePlus(i)}},model:{value:i.quantity,callback:function(a){t.$set(i,"quantity",a)},expression:"item.quantity"}})],1),s("div",{staticClass:"subtotal"},[s("p",[t._v("\xA5 "+t._s(((((l=i.sku)===null||l===void 0?void 0:l.discount)||((u=i.sku)===null||u===void 0?void 0:u.price))*i.quantity).toFixed(2)))]),i.sku.discount?s("p",{staticClass:"discount"},[t._v(" \u5DF2\u4F18\u60E0 \xA5"+t._s(((i.sku.price-i.sku.discount)*i.quantity).toFixed(2))+" ")]):t._e()]),s("div",{staticClass:"operation"},[s("i",{staticClass:"btn-delete",on:{click:function(a){return t.deleteFromCart(i.sku.id)}}})])])])}),0)],1)],1),s("div",{staticClass:"footer",class:{fixed:t.fixed}},[s("div",{staticClass:"left"},[s("sm-checkbox",{attrs:{title:"\u5168\u9009"},model:{value:t.selAllSku,callback:function(i){t.selAllSku=i},expression:"selAllSku"}}),s("span",{staticClass:"delete",class:{disabled:!t.selSkus.length},on:{click:function(i){return t.deleteFromCart()}}},[t._v("\u5220\u9664\u9009\u4E2D\u7684\u5546\u54C1")])],1),s("div",{staticClass:"right"},[s("div",{staticClass:"total-quantity"},[s("p",[t._v(" \u5DF2\u9009\u4E2D "),s("span",{staticClass:"red"},[t._v(t._s(t.skuQuantity))]),t._v(" \u6B3E\u5546\u54C1 ")]),s("p",[t._v(" \u5171\u8BA1 "),s("span",[t._v(t._s(t.totalQuantity))]),t._v(" \u4EF6\u5546\u54C1 ")])]),s("div",{staticClass:"total-price"},[s("p",[t._v(" \u5E94\u4ED8\u603B\u989D\uFF1A"),s("span",{staticClass:"red"},[s("i",[t._v("\xA5")]),t._v(t._s(t.totalPrice.toFixed(2)))])]),s("p",[t._v(" \u4F18\u60E0\u603B\u989D\uFF1A"),s("span",[s("i",[t._v("\xA5")]),t._v(t._s(t.totalDiscount.toFixed(2)))])])]),s("sm-button",{attrs:{width:120,height:40,size:14},on:{click:t.gotoCheckout}},[t._v("\u7ACB\u5373\u8D2D\u4E70")])],1)])]):s("div",{staticClass:"empty"},[s("img",{attrs:{src:d}}),s("p",{staticClass:"title"},[t._v("\u60A8\u7684\u8D2D\u7269\u8F66\u4E2D\u8FD8\u6CA1\u6709\u5546\u54C1")]),s("sm-button",{attrs:{width:160,height:50,size:14,color:"gray",to:"/mall"}},[t._v("\u73B0\u5728\u9009\u8D2D")])],1)])],1)},_=[];const h={name:"Cart",data(){return{fixed:!0,el:null,offsetTop:0,selSkus:[],selAllSku:!0}},computed:{products(){return o.cloneDeep(this.$store.state.user.cart)},skuQuantity(){return this.selSkus.length},totalQuantity(){return this.products.filter(e=>this.selSkus.includes(e.sku.id)).reduce((e,s)=>e+s.quantity,0)},totalPrice(){return this.products.filter(e=>this.selSkus.includes(e.sku.id)).reduce((e,s)=>e+s.quantity*(s.sku.discount||s.sku.price),0)},totalDiscount(){return this.products.filter(e=>this.selSkus.includes(e.sku.id)&&e.sku.discount).reduce((e,s)=>e+s.quantity*(s.sku.price-s.sku.discount),0)}},watch:{selAllSku:{immediate:!0,handler(t){t?this.selSkus=this.products.map(e=>e.sku.id):this.selSkus=[]}},products:{immediate:!0,handler(){this.recalc()}}},methods:{gotoCheckout(){const t=this.products.filter(e=>this.selSkus.includes(e.sku.id));this.$router.push({name:"Checkout",params:{products:t}})},handleMinus(t){this.$store.dispatch("user/addToCart",{sku:t.sku,quantity:-1})},handlePlus(t){this.$store.dispatch("user/addToCart",{sku:t.sku,quantity:1})},deleteFromCart(t){let e=[];t?e.push(t):e=this.selSkus,this.$store.dispatch("user/deleteFromCart",{skuIds:e}),this.selSkus=this.selSkus.filter(s=>!e.includes(s))},handleScroll(){this.fixed=this.el.clientHeight+this.el.scrollTop<=this.offsetTop},recalc(){this.$nextTick(()=>{this.el=document.documentElement;const t=document.querySelector("#\u{1F6D2}");this.offsetTop=t.clientHeight+t.offsetTop,window.addEventListener("scroll",this.handleScroll),this.handleScroll()})}}},c={};var v=n(h,p,_,!1,k,"3ee48a38",null,null);function k(t){for(let e in c)this[e]=c[e]}const f=function(){return v.exports}();export{f as default};
