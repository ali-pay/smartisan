import{n as $,j as k,e as C,p as m,_ as p}from"./index.7707aae4.js";var S=function(){var e,a,n,i,o,l,u,h,v,f,s=this,y=s.$createElement,t=s._self._c||y;return t("sm-loading",{attrs:{loading:s.loading,title:"\u52A0\u8F7D\u4E2D",center:""}},[s.spu?t("div",{staticClass:"wrapper"},[t("sm-box",[t("div",{staticClass:"item-wrapper"},[t("div",{staticClass:"image-wrapper"},[t("div",{staticClass:"thumbs-wrapper"},s._l(s.sku.images,function(c,r){return t("img",{key:r,class:{active:s.imgIndex===r},attrs:{src:c},on:{mouseenter:function(_){s.imgIndex=r}}})}),0),t("div",{staticClass:"gallery-wrapper"},[t("img",{attrs:{src:s.sku.images[s.imgIndex]}})])]),t("div",{staticClass:"detail-wrapper"},[t("div",{staticClass:"info"},[t("div",[t("p",{staticClass:"title"},[s._v(s._s(s.spu.title))]),t("p",{staticClass:"desc"},[s._v(s._s(s.spu.desc))])]),t("div",{staticClass:"prices"},[t("p",{staticClass:"discount"},[t("i",[s._v("\xA5")]),s._v(s._s(((e=s.sku)===null||e===void 0||(a=e.discount)===null||a===void 0?void 0:a.toFixed(2))||((n=s.sku)===null||n===void 0||(i=n.price)===null||i===void 0?void 0:i.toFixed(2))))]),s.sku.discount?t("p",{staticClass:"price"},[s._v("\u539F\u4EF7\uFF1A\xA5"+s._s((o=s.sku)===null||o===void 0||(l=o.price)===null||l===void 0?void 0:l.toFixed(2)))]):s._e()])]),t("ul",{staticClass:"specs"},[s._l(s.specs,function(c,r,_){return[t("li",{key:_+1e3,staticClass:"spec",class:r.includes("\u989C\u8272")?"colors":"models"},[t("p",{staticClass:"title"},[s._v(s._s(r)+"\u9009\u62E9")]),t("ul",{staticClass:"list"},s._l(c,function(d,x){return t("li",{key:x,staticClass:"item",class:[{active:d.active},{disabled:d.disabled}],on:{click:function(w){return s.clickSpecs(r,d)}}},[d.image?t("img",{staticClass:"img",attrs:{src:d.image}}):d.hex?t("div",{staticClass:"img",style:{background:d.hex}}):t("span",[s._v(s._s(d.value))])])}),0)]),t("li",{key:_+2e3,staticClass:"spec line-dashed"})]}),t("li",{staticClass:"spec quantity"},[t("p",{staticClass:"title"},[s._v("\u6570\u91CF\u9009\u62E9")]),t("ul",{staticClass:"list"},[t("li",{staticClass:"item"},[t("sm-input-number",{model:{value:s.quantity,callback:function(c){s.quantity=c},expression:"quantity"}})],1)])]),t("li",{staticClass:"spec line-solid"}),(u=s.sku)!==null&&u!==void 0&&(h=u.tips)!==null&&h!==void 0&&h.length?t("li",{staticClass:"spec tips"},[t("p",{staticClass:"title"},[s._v("\u670D\u52A1\u8BF4\u660E")]),t("ul",{staticClass:"list"},s._l(s.sku.tips,function(c,r){return t("li",{key:r,staticClass:"item"},[s._v(s._s(c))])}),0)]):s._e()],2)])])]),t("sm-box",{attrs:{title:"\u4EA7\u54C1\u4FE1\u606F"}},[t("img",{staticClass:"image-pc",attrs:{src:s.sku.image_pc},on:{load:function(c){return s.loadImage()}}})])],1):s._e(),s.spu?t("div",{staticClass:"bar-wrapper",class:{fixed:s.fixed}},[t("div",{staticClass:"container"},[t("div",{staticClass:"left"},[t("p",{staticClass:"tip"},[s._v("\u60A8\u5DF2\u9009\u62E9\uFF1A")]),t("div",{staticClass:"info"},[t("p",{staticClass:"title"},[s._v(s._s(s.spu.title)+" \xD7 "+s._s(s.quantity))]),t("ul",{staticClass:"specs"},s._l(s.selSpecs,function(c,r){return t("li",{key:r,staticClass:"spec"},[s._v(s._s(c.value))])}),0)])]),t("div",{staticClass:"right"},[t("div",{staticClass:"prices"},[t("p",{staticClass:"discount"},[t("i",[s._v("\xA5")]),s._v(s._s(((((v=s.sku)===null||v===void 0?void 0:v.discount)||((f=s.sku)===null||f===void 0?void 0:f.price))*s.quantity).toFixed(2)))]),s.sku.discount?t("p",{staticClass:"price"},[s._v("\u539F\u4EF7\uFF1A\xA5"+s._s((s.sku.price*s.quantity).toFixed(2)))]):s._e()]),t("sm-button",{attrs:{id:"\u{1F6D2}",width:120,height:35,size:14,color:"gray"},on:{click:s.addToCart}},[s._v("\u52A0\u5165\u8D2D\u7269\u8F66")]),t("sm-button",{attrs:{width:120,height:35,size:14},on:{click:s.gotoCheckout}},[s._v("\u7ACB\u5373\u8D2D\u4E70")])],1)])]):s._e(),s._l(s.aniCount,function(c){return t("transition",{key:c,attrs:{appear:""},on:{"before-enter":s.beforeEnter,"after-enter":s.afterEnter}},[s.animation?t("div",{staticClass:"animation",style:{top:`${s.aniEndTop}px`,left:`${s.aniEndLeft}px`}},[t("img",{attrs:{src:s.aniImg}})]):s._e()])})],2)},b=[];const E={name:"Item",data(){return{spu:null,sku:null,imgIndex:0,quantity:1,specs:null,selSpecs:[],loading:!0,fixed:!0,el:null,offsetTop:0,animation:!1,aniImg:"",aniStartTop:0,aniStartLeft:0,aniEndTop:0,aniEndLeft:0,aniCount:1}},mounted(){var a,n;this.$route.params.id.includes(k.spu.id)&&(this.spu=k.spu),this.$route.params.id.includes(C.spu.id)&&(this.spu=C.spu),this.$route.params.id.includes(m.spu.id)&&(this.spu=m.spu),this.sku=this.spu.skus.find(i=>i.id===this.$route.params.id);const e={};(n=(a=this.spu)==null?void 0:a.specs)==null||n.forEach(i=>{e[i.key]||(e[i.key]=[]),e[i.key].push({skus:i==null?void 0:i.skus,value:i==null?void 0:i.value,image:i==null?void 0:i.image,hex:i==null?void 0:i.hex,disabled:i.disabled||!1,active:i.active||!1})}),this.specs=e},methods:{loadImage(){this.loading=!1,this.$nextTick(()=>{this.el=document.documentElement,this.offsetTop=document.querySelector(".sm-footer").offsetTop,this.offsetTop+=document.querySelector(".bar-wrapper").clientHeight,window.addEventListener("scroll",this.handleScroll),this.handleScroll()}),p.keys(this.specs).forEach(a=>{const n=this.specs[a].find(i=>i.skus.includes(this.sku.id));n&&this.clickSpecs(a,n)})},clickSpecs(e,a){const n=p.keys(this.specs);n.forEach(o=>{const l=this.specs[o].find(u=>u.value===a.value);!l||(l&&(l.active=!l.active),l.active?this.selSpecs.push(l):this.selSpecs=this.selSpecs.filter(u=>l.key!==u.key||l.value!==u.value))});let i=this.selSpecs.map(o=>o.skus);i=p.intersection(...i),n.forEach(o=>{this.specs[o].forEach(l=>{if(l.disabled=!1,!i.length)return;p.intersection(l.skus,i).length||(l.disabled=!0)})}),i.length&&!i.includes(this.sku.id)&&(this.sku=this.spu.skus.find(o=>o.id===p.head(i)))},handleScroll(){this.fixed=this.el.clientHeight+this.el.scrollTop<=this.offsetTop},gotoCheckout(){this.$router.push({name:"Checkout",params:{products:[{sku:this.sku,quantity:this.quantity}]}})},addToCart(){this.$store.dispatch("user/addToCart",{sku:this.sku,quantity:this.quantity});const e=document.querySelector("#\u{1F6D2}").getBoundingClientRect();this.aniStartTop=e.top-e.height,this.aniStartLeft=e.left+e.width/2;const a=document.querySelector(".header-cart").getBoundingClientRect();this.aniEndTop=a.top,this.aniEndLeft=a.left,this.animation=!0,this.aniImg=this.sku.image,this.aniCount++},beforeEnter(e){const a=e.style,i=e.children[0].style;a.transform=`translate3d(0, ${this.aniStartTop-this.aniEndTop}px, 0)`,i.transform=`translate3d(${-(this.aniEndLeft-this.aniStartLeft)}px, 0, 0) scale(2)`},afterEnter(e){const a=e.style,n=e.children[0],i=n.style;a.transform="translate3d(0, 0, 0)",i.transform="translate3d(0, 0, 0) scale(0)",a.transition="transform .6s cubic-bezier(0.3, 0.55, 0.5, 1.1)",i.transition="transform .6s linear",n.addEventListener("transitionend",()=>{this.animation=!1}),n.addEventListener("webkitAnimationEnd",()=>{this.animation=!1})}}},g={};var T=$(E,S,b,!1,q,"53766222",null,null);function q(e){for(let a in g)this[a]=g[a]}const L=function(){return T.exports}();export{L as default};
